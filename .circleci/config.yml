version: 2.1
orbs:
  aws-eks: circleci/aws-eks@1.0.3
  aws-ecr: circleci/aws-ecr@6.15.3
  kubernetes: circleci/kubernetes@0.11.2

jobs:
  create-cluster:
    executor: aws-eks/python3
    steps:
      - checkout
      - run:
          name: create cluster
          command: |
            curl --silent --location "https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp
            sudo mv /tmp/eksctl /usr/local/bin

            sudo eksctl create cluster --version 1.17 --name demo-cluster --region us-east-1 --nodegroup-name linux-nodes --node-type t2.micro --nodes 2

            #pwd
            #ls -la
            #cd /home/circleci/project/k8s
            #aws eksctl create cluster -f cluster.yaml

      - run:
          name: create cluster
          command: |
            sudo eksctl eksctl delete cluster --name capstone --region us-east-1


workflows:
  main:
    jobs:
      - create-cluster
