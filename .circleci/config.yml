version: 2.1
jobs:
  create-docker:
    machine: true
    steps:
      - checkout
      - run:
          name: create docker image
          command: |
            pwd
            ls -al
            cd ~/project/.circleci/dockerstuff
            ls -la

      - run:
          name: build docker image
          command: |
            ls -la
            cd ~/project/.circleci/dockerstuff
            sh run_docker.sh
      - run:
          name: get docker container ID
          command: |
            docker ps -aq
      - run:
          name: commit container
          command: |
            docker container commit $(docker ps -qa) joepub/capstone
      - run:
          name: Upload to repo
          command: |
            echo $DOCKER_LOGIN
            echo $DOCKER_PASSWORD
            echo "$DOCKER_PASSWORD" | docker login --username $DOCKER_LOGIN --password-stdin
            docker push joepub/capstone




workflows:
  default:
    jobs:
      - create-docker
